<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Topologies Visualizer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-row">
                <h1>Team Topologies Visualizer</h1>
                <div class="header-actions">
                    <button id="exportSVGBtn" class="btn">üì• Export SVG</button>
                    <button id="validateBtn" class="btn">‚úì Validate</button>
                    <button id="refreshBtn" class="btn">üîÑ Refresh</button>
                </div>
            </div>
            <div class="header-row controls-row">
                <div class="controls-left">
                    <div class="view-selector">
                        <label class="radio-label">
                            <input type="radio" name="view" value="current" id="viewCurrent">
                            <span>Pre-TT</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="view" value="tt" id="viewTT" checked>
                            <span>TT Design</span>
                        </label>
                    </div>
                    <div class="view-options">
                        <label class="radio-label" id="showConnectionsLabel" style="display: none;">
                            <input type="checkbox" id="showConnections">
                            <span>Show Communication Lines</span>
                        </label>
                        <label class="radio-label" id="showInteractionModesLabel" style="display: none;">
                            <input type="checkbox" id="showInteractionModes" checked>
                            <span>Show Interaction Modes</span>
                        </label>
                        <span class="inline-divider" id="modesCognitiveLoadDivider" style="display: none;"></span>
                        <label class="radio-label">
                            <input type="checkbox" id="showCognitiveLoad">
                            <span>üö¶ Cognitive Load</span>
                        </label>
                    </div>
                    <div id="groupingFilterContainer" class="filter-panel" style="display: none;">
                        <button id="filterToggleBtn" class="btn filter-toggle-btn">
                            <span>üîç Filters</span>
                            <span class="filter-count" id="filterCount"></span>
                        </button>
                        <div id="filterDropdown" class="filter-dropdown-panel">
                            <div class="filter-section">
                                <div class="filter-section-header">
                                    <strong>Value Streams</strong>
                                    <button class="filter-clear-btn" data-type="vs">Clear</button>
                                </div>
                                <div id="valueStreamFilters" class="filter-options"></div>
                            </div>
                            <div class="filter-section">
                                <div class="filter-section-header">
                                    <strong>Platform Groupings</strong>
                                    <button class="filter-clear-btn" data-type="pg">Clear</button>
                                </div>
                                <div id="platformGroupingFilters" class="filter-options"></div>
                            </div>
                            <div class="filter-actions">
                                <button id="clearAllFiltersBtn" class="btn btn-secondary">Clear All</button>
                                <button id="applyFiltersBtn" class="btn btn-primary">Apply</button>
                            </div>
                        </div>
                    </div>
                    <button id="autoAlignBtn" class="btn" style="display: none;">‚ö° Auto-align</button>
                    <button id="autoAlignTTBtn" class="btn" style="display: none;">‚ö° Auto-align</button>
                </div>
                <div class="zoom-controls">
                    <button id="zoomOutBtn" class="btn btn-icon" title="Zoom Out (Ctrl+-)">-</button>
                    <span id="zoomLevel" class="zoom-level">100%</span>
                    <button id="zoomInBtn" class="btn btn-icon" title="Zoom In (Ctrl++)">+</button>
                    <button id="fitViewBtn" class="btn btn-icon" title="Fit to View (Ctrl+0)">‚ä°</button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <aside class="sidebar">
                <h3>Teams</h3>
                <div class="search-container">
                    <input type="text" id="teamSearch" placeholder="üîç Search teams..." class="search-input">
                </div>
                <div id="teamList" class="team-list"></div>
                
                <div class="legend">
                    <h4>Team Types</h4>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #4A90E2;"></span>
                        <span>Stream-aligned</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #7ED321;"></span>
                        <span>Platform</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #F5A623;"></span>
                        <span>Enabling</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #BD10E0;"></span>
                        <span>Complicated Subsystem</span>
                    </div>
                </div>
            </aside>

            <main class="canvas-area">
                <canvas id="teamCanvas"></canvas>
            </main>
        </div>
    </div>

    <!-- Modal for adding/editing teams -->
    <div id="teamModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Add Team</h2>
            <form id="teamForm">
                <div class="form-group">
                    <label for="teamName">Team Name</label>
                    <input type="text" id="teamName" required>
                </div>
                
                <div class="form-group">
                    <label for="teamType">Team Type</label>
                    <select id="teamType" required>
                        <option value="stream-aligned">Stream-aligned</option>
                        <option value="platform">Platform</option>
                        <option value="enabling">Enabling</option>
                        <option value="complicated-subsystem">Complicated Subsystem</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="teamDescription">Description</label>
                    <textarea id="teamDescription" rows="4"></textarea>
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn" id="cancelBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for team details -->
    <div id="detailModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" id="detailModalClose">&times;</span>
            <div id="teamDetails">
                <div class="detail-header">
                    <h2 id="detailTeamName"></h2>
                    <span id="detailTeamType" class="team-badge"></span>
                </div>
                
                <div class="detail-section">
                    <h3>Description</h3>
                    <div id="detailDescription" class="markdown-content"></div>
                </div>
                
                <div class="detail-grid">
                    <div class="detail-section">
                        <h3>Dependencies</h3>
                        <ul id="detailDependencies" class="detail-list"></ul>
                    </div>
                    
                    <div class="detail-section">
                        <h3>Interaction Modes</h3>
                        <ul id="detailInteractions" class="detail-list"></ul>
                    </div>
                </div>
                
                <div class="detail-section" id="detailMetadataSection">
                    <h3>Metadata</h3>
                    <div id="detailMetadata" class="metadata-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interaction Mode Info Modals -->
    <div id="interactionModeModal" class="modal">
        <div class="modal-content modal-medium">
            <span class="close" id="interactionModeModalClose">&times;</span>
            <div id="interactionModeContent"></div>
        </div>
    </div>

    <!-- Validation Report Modal -->
    <div id="validationModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" id="validationModalClose">&times;</span>
            <h2>File Validation Report</h2>
            <div id="validationReport"></div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
